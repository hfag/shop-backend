!function($){"use strict";function i(i){return i.replace(/ /g,"-")}function t(i,r,a,o,s){var n=i.sku.length,u=i.image_code.length;if(r<n+u){var l=i.sku.slice(Math.max(r,0),Math.min(r+a,n)),_=i.image_code.slice(Math.max(r-n,0),Math.min(Math.max(r-n,0)+(a-l.length)),u);e({sku:l,image_code:_},function(e){o.sku=jQuery.extend(o.sku,e.sku),o.image_code=jQuery.extend(o.image_code,e.image_code),t(i,r+a,a,o,s)})}else s(o)}function e(i,t){jQuery.post(n,{action:"get_product_id_attachment_id",data:i},t)}function r(t){var e={product_type:t.product_type,post_id:t.post_id,_tax_status:"taxable",_tax_class:"",_purchase_note:"",_weight:"",_length:"",_width:"",_height:"",_visibility:"visible",product_shipping_class:-1,_stock_status:"instock",_backorders:"no",attribute_names:[],attribute_values:[],attribute_position:[],attribute_visibility:{},attribute_variation:{},attribute_is_taxonomy:{},categories:[]};if(!("Artikel_Nummer_Produkt"in t))return alert("ERROR while importing: A product doesn't have a sku (DE: Artikelnummer)!"),!1;if(e._sku=t.Artikel_Nummer_Produkt,"simple"===t.product_type){if(!("Einzelpreis"in t))return alert("ERROR while importing: "+t.Artikel_Nummer_Produkt+" doesn't have a price set!"),!1;if(t.Einzelpreis.indexOf(" ")!==-1?e._regular_price=t.Einzelpreis.split(" ")[1]:e._regular_price=t.Einzelpreis,!("thumbnail_id"in t))return alert("ERROR while importing: "+t.Artikel_Nummer_Produkt+" doesn't have a thumbnail set!"),!1;if(e.thumbnail_id=t.thumbnail_id,!("Artikelname_neu"in t))return alert("ERROR while importing: "+t.Artikel_Nummer_Produkt+" doesn't have a name set!"),!1;e.post_title=t.Artikelname_neu}else"variable"===t.product_type;"Breite"in t&&(e._length=t.Breite),"Höhe"in t&&(e._height=t.Höhe),"Stärke"in t&&(e._width=t.Stärke),"Thema"in t&&e.categories.push(t.Thema),"bulk_discount"in t&&(e.bulk_discount=t.bulk_discount),"discounts"in t&&(e.discounts=t.discounts),"min_purchase_qty"in t&&(e.min_purchase_qty=t.min_purchase_qty);var r=0;for(var a in t.attributes)e.attribute_names.push(t.attributes[a].is_taxonomy?"pa_"+t.attributes[a].slug:t.attributes[a].name),e.attribute_values.push(t.attributes[a].values.join("|")),e.attribute_position.push(t.attributes[a].position),t.attributes[a].visibility===!0&&(e.attribute_visibility[r]=!0),t.attributes[a].variation===!0&&(e.attribute_variation[r]=!0),t.attributes[a].is_taxonomy===!0&&(e.attribute_is_taxonomy[r]=!0),r++;if("products"in t){e.variable_post_id={},e.variable_sku={},e.variable_regular_price={},e.upload_image_id={},e.variable_shipping_class={},e.variable_tax_class={},e.variation_menu_order={},e.variable_sale_price_dates_from={},e.variable_sale_price_dates_to={},e.variable_weight={},e.variable_length={},e.variable_width={},e.variable_height={},e.variable_bulk_discount={},e.variable_apply_reseller_discount={},e.variable_enabled={},e.variable_is_virtual={},e.variable_is_downloadable={},e.variable_manage_stock={},e.variable_stock={},e.variable_backorders={},e.variable_stock_status={},e.variable_description={};for(var o=0;o<t.products.length;o++){if(!("post_id"in t.products[o]))return alert("ERROR while importing: A product doesn't have a post_id! (Report this to Nico Hauser, probably the error isn't caused by the imported file.)"),!1;if(e.variable_post_id[o]=t.products[o].post_id,!("Artikel_Nummer_Produkt"in t.products[o]))return alert("ERROR while importing: A product doesn't have a sku (DE: Artikelnummer)!"),!1;if(e.variable_sku[o]=t.products[o].Artikel_Nummer_Produkt,!("Einzelpreis"in t.products[o]))return alert("ERROR while importing: "+t.products[o].Artikel_Nummer_Produkt+" doesn't have a price set!"),!1;if(e.variable_regular_price[o]=t.products[o].Einzelpreis.split(" ")[1],!("upload_image_id"in t.products[o]))return alert("ERROR while importing: "+t.products[o].Artikel_Nummer_Produkt+" doesn't have a image set!"),!1;e.upload_image_id[o]=t.products[o].upload_image_id,"thumbnail_id"in e||(e.thumbnail_id=t.products[o].upload_image_id),e.variable_shipping_class[o]=-1,e.variable_tax_class[o]="",e.variation_menu_order[o]=o,"Breite"in t.products[o]&&(e.variable_length[o]=t.products[o].Breite),"Höhe"in t.products[o]&&(e.variable_height[o]=t.products[o].Höhe),"Stärke"in t.products[o]&&(e.variable_width[o]=t.products[o].Stärke),"Thema"in t.products[o]&&e.categories.indexOf(t.products[o].Thema)===-1&&e.categories.push(t.products[o].Thema),"bulk_discount"in t.products[o]&&(e.variable_bulk_discount[o]=t.products[o].bulk_discount),e.variable_enabled[o]=!0,e.variable_backorders[o]=!1,e.variable_stock_status[o]="instock","Artikelname_neu"in t.products[o]&&(e.variable_description[o]=t.products[o].Artikelname_neu,"post_title"in e||(e.post_title=t.products[o].Artikelname_neu));for(a in t.attributes)if(t.attributes[a].is_taxonomy===!0)"attribute_pa_"+t.attributes[a].slug in e||(e["attribute_pa_"+t.attributes[a].slug]={}),e["attribute_pa_"+t.attributes[a].slug][o]=i(t.products[o][a]);else{var s=i(t.attributes[a].name);"attribute_"+s in e||(e["attribute_"+s]={}),e["attribute_"+s][o]=t.products[o][a]}}}return e}function a(i){var e=i.target.result,a=u.read(e,{type:"binary"}),s=a.SheetNames;$("<progress id='import-progress' style='width:100%;'></progress>").insertAfter($("#log-ajax")),s.forEach(function(i){var e=u.utils.sheet_to_json(a.Sheets[i]),s=[],n={},p={sku:[],image_code:[]},d,m,c,h,g,v,b;for(g=0;g<e.length;g++)if(e[g].Produktgruppe_Shop=e[g].Produktgruppe_Shop.trim(),1===e[g].Shop_Produkt_Ja_Nein||"1"===e[g].Shop_Produkt_Ja_Nein){for(var k in e[g])k.indexOf("_Rabattberechtigt")!==-1&&k in l==!1&&(l[k]=k.replace("_Rabattberechtigt",""));if(!("Artikel_Nummer_Produkt"in e[g]))return alert("ERROR while importing: A product doesn't have a sku (DE: Artikelnummer)!"),!1;if(p.sku.indexOf(e[g].Artikel_Nummer_Produkt)!==-1)return alert("ERROR while importing: Multiple products can't have the same sku (DE: Artikelnummer)!"),!1;if(p.sku.push(e[g].Artikel_Nummer_Produkt),!("Artikel_Bilder_Code"in e[g]))return alert("ERROR while importing: "+e[g].Artikel_Nummer_Produkt+" doesn't have a image set!"),!1;p.image_code.indexOf(e[g].Artikel_Bilder_Code)===-1&&p.image_code.push(e[g].Artikel_Bilder_Code),"Stückzahl pro Einheit"in e[g]&&e[g]["Stückzahl pro Einheit"]&&"Einheit"in e[g]&&(e[g].Einheit=e[g].Einheit+" ("+e[g]["Stückzahl pro Einheit"]+" STK)");var f=[];for(k in e[g])if(k.indexOf("VP Staffel ")!==-1&&k in l==!1&&""!==e[g][k].trim()){var y=parseFloat(e[g][k].replace("CHF","").trim()),P=parseInt(k.replace("VP Staffel ","").trim(),10);y>0&&P>0&&f.push({qty:P,ppu:y})}if(f!=={}&&(e[g].bulk_discount=f),"Mindestbestellmenge"in e[g]&&(e[g].min_purchase_qty=parseInt(e[g].Mindestbestellmenge,10)),e[g].discounts=[],void 0!==e[g].Produktgruppe_Shop)p.sku.indexOf(e[g].Produktgruppe_Shop)===-1&&p.sku.push(e[g].Produktgruppe_Shop),e[g].Produktgruppe_Shop in n?n[e[g].Produktgruppe_Shop].push(e[g]):n[e[g].Produktgruppe_Shop]=[e[g]];else{e[g].product_type="simple",e[g].attributes=[];for(d in _)_.hasOwnProperty(d)&&d in e[g]&&(m=jQuery.extend(!0,{},_[d]),m.variation=!1,m.values=[e[g][d]],e[g].attributes.push(m));for(h in l)l.hasOwnProperty(h)&&h in e[g]&&1===parseInt(e[g][h].trim(),10)&&e[g].discounts.push(l[h]);s.push(e[g])}}var R={};for(c in n)if(n.hasOwnProperty(c))for(R[c]={},v=0;v<n[c].length;v++)if(0===v)for(d in _)_.hasOwnProperty(d)&&d in n[c][v]&&(R[c][d]=jQuery.extend(!0,{},_[d]),R[c][d].values.push(n[c][v][d]));else for(d in R[c]){if(!(d in n[c][v]))return void alert("ERROR: "+n[c][v].Artikel_Nummer_Produkt+" doesn't have the attribute "+d+" but is in the same variation group as "+n[c][0].Artikel_Nummer_Produkt);R[c][d].values.indexOf(n[c][v][d])===-1&&R[c][d].values.push(n[c][v][d])}var x={};for(c in n)if(n.hasOwnProperty(c)){for(x[c]=[],v=0;v<n[c].length;v++)if(0===v)for(h in l)l.hasOwnProperty(h)&&h in n[c][v]&&1===parseInt(n[c][v][h].trim(),10)&&x[c].push(h);else for(b=0;b<x[c].length;b++)if(!(h in n[c][v]&&1===parseInt(n[c][v][h].trim(),10)))return void alert("ERROR: "+n[c][v].Artikel_Nummer_Produkt+" doesn't have the discount group "+h+" but is in the same variation group as "+n[c][0].Artikel_Nummer_Produkt);for(b=0;b<x[c].length;b++)x[c][b]=l[x[c][b]]}var A={};for(c in n)if(n.hasOwnProperty(c))for(A[c]=0,v=0;v<n[c].length;v++)if(0===v){if(!("min_purchase_qty"in n[c][v]))break;A[c]=n[c][v].min_purchase_qty}else if(A[c]!==n[c][v].min_purchase_qty)return void alert("ERROR: "+n[c][v].Artikel_Nummer_Produkt+" doesn't have the discount group "+h+" but is in the same variation group as "+n[c][0].Artikel_Nummer_Produkt);for(c in n)n.hasOwnProperty(c)&&s.push({product_type:"variable",variation_group:c,Artikel_Nummer_Produkt:c,attributes:R[c],products:n[c],discounts:x[c],min_purchase_qty:A[c]});t(p,0,500,{sku:{},image_code:{}},function(i){var t,e,a,n,u,l=[];for(n in i.image_code)i.image_code.hasOwnProperty(n)||l.push(n),i.image_code[n]===!1&&l.push(n);if(0!==l.length)return alert("ERROR while importing: The following images are missing, upload them prior to importing products: "+l.join(", ")),!1;for(t=0;t<s.length;t++){if("simple"===s[t].product_type){for(a in i.sku)if(s[t].Artikel_Nummer_Produkt===a){s[t].post_id=i.sku[a];break}for(n in i.image_code)if(s[t].Artikel_Bilder_Code===n){s[t].thumbnail_id=i.image_code[n];break}}else if("variable"===s[t].product_type){for(a in i.sku)if(s[t].variation_group===a){s[t].post_id=i.sku[a];break}for(e=0;e<s[t].products.length;e++){for(a in i.sku)if(s[t].products[e].Artikel_Nummer_Produkt===a){s[t].products[e].post_id=i.sku[a];break}for(n in i.image_code)if(s[t].products[e].Artikel_Bilder_Code===n){s[t].products[e].upload_image_id=i.image_code[n];break}}}if(u=r(s[t]),u===!1)return u;s[t]=u}$("#log-filename").append(" Done!"),$("#import-progress").attr("value","0"),$("#import-progress").attr("max",s.length-1),o(s,0,function(){})})})}function o(i,t,e){return t>=i.length?void e():($("#log-ajax").append("<p>["+(t+1)+"/"+i.length+", "+Math.round(1e4*(t+1)/i.length)/100+"%] Adding "+i[t]._sku+"...</p>"),void jQuery.post(n,{action:"import_product",product_data:JSON.stringify(i[t])},function(r){$("#log-ajax p:last-child").append(" "+r.message),$("#import-progress").attr("value",t),$(window).scrollTop($(document).height()),o(i,t+1,e)}))}function s(i){i.stopPropagation(),i.preventDefault();var t=i.dataTransfer.files,e,r;for(e=0,r=t[e];e!==t.length;++e){var o=new FileReader,s=r.name;o.onload=a,$("#log-filename").append("Reading and parsing "+s+" ..."),o.readAsBinaryString(r)}}var n=window.ajaxurl,u=window.XLSX,l={},_={"Ausführung":{name:"Ausführung",slug:"model",position:50,visibility:!0,variation:!0,is_taxonomy:!1,values:[]},Pfeilrichtung:{name:"Pfeilrichtung",slug:"arrow-dir",position:0,visibility:!0,variation:!0,is_taxonomy:!1,values:[]},"Grösse":{name:"Grösse",slug:"size",position:1,visibility:!0,variation:!0,is_taxonomy:!0,values:[]},Jahr:{name:"Jahr",slug:"year",position:60,visibility:!0,variation:!0,is_taxonomy:!1,values:[]},Farbe:{name:"Farbe",slug:"color",position:70,visibility:!0,variation:!0,is_taxonomy:!1,values:[]},Format:{name:"Format",slug:"format",position:80,visibility:!0,variation:!0,is_taxonomy:!1,values:[]},Leuchtdichte_mcd:{name:"Leuchtdichte",slug:"luminance",position:40,visibility:!0,variation:!0,is_taxonomy:!0,values:[]},Material:{name:"Material",slug:"material",position:10,visibility:!0,variation:!0,is_taxonomy:!0,values:[]},Norm:{name:"Norm",slug:"norm",position:90,visibility:!0,variation:!0,is_taxonomy:!1,values:[]},PSPA_Class:{name:"PSPA Klasse",slug:"pspa-class",position:100,visibility:!0,variation:!0,is_taxonomy:!1,values:[]},Ursprungsland:{name:"Ursprungsland",slug:"country",position:120,visibility:!0,variation:!0,is_taxonomy:!0,values:[]},Eigenschaft_Druck:{name:"Druckeigenschaft(-en)",slug:"print-property",position:110,visibility:!0,variation:!0,is_taxonomy:!0,values:[]},Einheit:{name:"Einheit",slug:"unit",position:1e3,visibility:!0,variation:!0,is_taxonomy:!0,values:[]},Symbolnummer:{name:"Symbolnummer",slug:"symbol-number",position:990,visibility:!0,variation:!0,is_taxonomy:!0,values:[]},Inhalt:{name:"Inhalt",slug:"content",position:1,visibility:!0,variation:!0,is_taxonomy:!1,values:[]},Variante:{name:"Variante",slug:"product_variation",position:0,visibility:!0,variation:!0,is_taxonomy:!1,values:[]}};$("#drop-excel").on("dragover",function(i){i.preventDefault(),i.stopPropagation(),$(this).addClass("dragging")}),$("#drop-excel").on("dragleave",function(i){i.preventDefault(),i.stopPropagation(),$(this).removeClass("dragging")}),document.getElementById("drop-excel").addEventListener("drop",s,!1)}(jQuery);
//# sourceMappingURL=./excel-json-product.min.js.map